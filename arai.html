<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ARAI - Arduino Assistant</title>
<style>
  body {
    background-color: #000;
    color: #eee;
    font-family: 'Inter', sans-serif;
    margin: 20px;
  }
  #chat {
    max-width: 600px;
    margin: auto;
    border: 1px solid #555;
    padding: 15px;
    border-radius: 8px;
    background-color: #111;
    position: relative;
  }
  .message {
    margin-bottom: 15px;
    white-space: pre-wrap;
    font-family: monospace;
  }
  .bot {
    color: #6cf;
  }
  .user {
    color: #fc6;
    text-align: right;
  }
  button.option-btn {
    background-color: #333;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 6px 12px;
    margin: 4px;
    cursor: pointer;
    font-weight: bold;
  }
  button.option-btn:hover {
    background-color: #555;
  }
  .top-right-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #222;
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1000;
  }
  .top-right-btn:hover {
    background-color: #444;
  }
  .rainbow-link {
    font-weight: bold;
    text-decoration: none;
    animation: rainbow 2s linear infinite;
    background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
    background-size: 400% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  @keyframes rainbow {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }
</style>
</head>
<body>

<button class="top-right-btn" onclick="window.location.href='https://mehmetakifkaraman.github.io/'">Main Menu</button>

<div id="chat"></div>

<script>
  const chat = document.getElementById('chat');

  async function slowPrint(text, className = 'bot') {
    const messageElem = document.createElement('div');
    messageElem.className = 'message ' + className;
    chat.appendChild(messageElem);

    for (let i = 0; i < text.length; i++) {
      messageElem.textContent += text[i];
      await new Promise(r => setTimeout(r, 30));
      window.scrollTo(0, document.body.scrollHeight);
    }
    return messageElem;
  }

  function showUserMessage(text) {
    const userMsg = document.createElement('div');
    userMsg.className = 'message user';
    userMsg.textContent = text;
    chat.appendChild(userMsg);
    window.scrollTo(0, document.body.scrollHeight);
  }

  function createOptions(options) {
    const container = document.createElement('div');
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt.label;
      btn.className = 'option-btn';
      btn.onclick = () => {
        container.remove();
        handleUserInput(opt.value);
      };
      container.appendChild(btn);
    });
    chat.appendChild(container);
    window.scrollTo(0, document.body.scrollHeight);
  }

  async function handleUserInput(input) {
    showUserMessage(input);

    switch (state.step) {
      case 0:
        if (input === 'installed') {
          await slowPrint("Great! Let's continue. üéâ");
          state.step++;
          askProjectChoice();
        } else if (input === 'not_installed') {
          await slowPrint("No worries! You can download the Arduino IDE here: ");
          const link = document.createElement('a');
          link.href = 'https://www.arduino.cc/en/software';
          link.target = '_blank';
          link.className = 'rainbow-link';
          link.textContent = 'https://www.arduino.cc/en/software';
          const wrapper = document.createElement('div');
          wrapper.className = 'message bot';
          wrapper.appendChild(link);
          chat.appendChild(wrapper);
          window.scrollTo(0, document.body.scrollHeight);
        }
        break;

      case 1:
        if (['1','2','3'].includes(input)) {
          state.project = input;
          showProjectDetails(input);
        } else {
          await slowPrint("Please select a valid option.");
          askProjectChoice();
        }
        break;

      case 2:
        await slowPrint("Your project is ready! Would you like to try something else? üòä");
        await slowPrint("Do you need help with anything else?");
        // Restart to ask again
        state.step = 1;
        askProjectChoice();
        break;
    }
  }

  function askIdeStatus() {
    slowPrint("Hello! I'm ARAI ü§ñ Your Arduino project assistant.\n");
    setTimeout(() => {
      slowPrint("Is Arduino IDE installed on your computer?").then(() => {
        createOptions([
          {label: "Installed", value: "installed"},
          {label: "Not Installed", value: "not_installed"}
        ]);
      });
    }, 800);
  }

  function askProjectChoice() {
    slowPrint("What would you like to do? Choose a number:\n1Ô∏è‚É£ Blink an LED\n2Ô∏è‚É£ Control LED with a button\n3Ô∏è‚É£ Measure temperature with DHT11")
    .then(() => {
      createOptions([
        {label: "1Ô∏è‚É£ Blink an LED", value: "1"},
        {label: "2Ô∏è‚É£ Control LED with Button", value: "2"},
        {label: "3Ô∏è‚É£ Measure Temp with DHT11", value: "3"},
      ]);
    });
  }

async function showProjectDetails(choice) {
  const details = {
    "1": {
      materials: "Materials needed:\nüîπ Arduino Uno or compatible board\nüîπ LED\nüîπ 220Œ© resistor\nüîπ Jumper wires\nüîπ Breadboard (optional)",
      steps: "Circuit connection steps:\n1Ô∏è‚É£ Connect LED's long leg to Arduino pin 13 üîå\n2Ô∏è‚É£ Connect LED's short leg through 220Œ© resistor to GND ‚ö°Ô∏è",
      code: [
        "// LED Blink Example",
        "int ledPin = 13;",
        "",
        "void setup() {",
        "  pinMode(ledPin, OUTPUT);",
        "}",
        "",
        "void loop() {",
        "  digitalWrite(ledPin, HIGH); // Turn LED on",
        "  delay(1000);",
        "  digitalWrite(ledPin, LOW);  // Turn LED off",
        "  delay(1000);",
        "}"
      ]
    },
    "2": {
      materials: "Materials needed:\nüîπ Arduino Uno or compatible board\nüîπ LED\nüîπ 220Œ© resistor\nüîπ Button\nüîπ Jumper wires\nüîπ Breadboard (optional)",
      steps: "Circuit connection steps:\n1Ô∏è‚É£ Connect one button leg to Arduino pin 2 üîò\n2Ô∏è‚É£ Connect the other button leg to GND\n3Ô∏è‚É£ Connect LED's long leg to Arduino pin 13 üîå\n4Ô∏è‚É£ Connect LED's short leg through 220Œ© resistor to GND ‚ö°Ô∏è",
      code: [
        "// Control LED with Button",
        "int ledPin = 13;",
        "int buttonPin = 2;",
        "int buttonState = 0;",
        "",
        "void setup() {",
        "  pinMode(ledPin, OUTPUT);",
        "  pinMode(buttonPin, INPUT);",
        "}",
        "",
        "void loop() {",
        "  buttonState = digitalRead(buttonPin);",
        "  if (buttonState == HIGH) {",
        "    digitalWrite(ledPin, HIGH);",
        "  } else {",
        "    digitalWrite(ledPin, LOW);",
        "  }",
        "}"
      ]
    },
    "3": {
      materials: "Materials needed:\nüîπ Arduino Uno or compatible board\nüîπ DHT11 Temperature & Humidity sensor\nüîπ Jumper wires\nüîπ Breadboard (optional)",
      steps: "Circuit connection steps:\n1Ô∏è‚É£ Connect DHT11 VCC to 5V üîã\n2Ô∏è‚É£ Connect GND to GND\n3Ô∏è‚É£ Connect data pin to Arduino pin 2 üì°",
      code: [
        "// Measure temperature with DHT11 (requires DHT library)",
        "#include <DHT.h>",
        "",
        "#define DHTPIN 2",
        "#define DHTTYPE DHT11",
        "",
        "DHT dht(DHTPIN, DHTTYPE);",
        "",
        "void setup() {",
        "  Serial.begin(9600);",
        "  dht.begin();",
        "}",
        "",
        "void loop() {",
        "  float h = dht.readHumidity();",
        "  float t = dht.readTemperature();",
        "",
        "  if (isnan(h) || isnan(t)) {",
        "    Serial.println(\"Failed to read from sensor!\");",
        "    return;",
        "  }",
        "",
        "  Serial.print(\"Humidity: \");",
        "  Serial.print(h);",
        "  Serial.print(\" %\\t\");",
        "  Serial.print(\"Temperature: \");",
        "  Serial.print(t);",
        "  Serial.println(\" *C\");",
        "  delay(2000);",
        "}"
      ]
    }
  };

  const p = details[choice];
  if (!p) {
    await slowPrint("Sorry, that option is not supported yet. üòî");
    return;
  }

  await slowPrint(p.materials);
  await slowPrint(p.steps);
  await slowPrint("Here's your Arduino code:");

  for (const line of p.code) {
    await slowPrint(line, 50);
  }

  await slowPrint("Do you want more project ideas or need help with something else?");

  // Restart project selection
  state.step = 1;
  askProjectChoice();
}

    const p = details[choice];
    if (!p) {
      await slowPrint("Sorry, that option is not supported yet. üòî");
      return;
    }

    await slowPrint(p.materials);
    await slowPrint(p.steps);

    for (const line of p.code) {
      await slowPrint(line, 50);
    }

    state.step = 2;
  }

  const state = { step: 0, project: null };

  askIdeStatus();
</script>

</body>
</html>
