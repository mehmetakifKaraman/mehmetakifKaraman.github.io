<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ARAI - Arduino Assistant</title>
<style>
  :root {
    --bg-color-dark: #000000;
    --text-color-dark: #eee;
    --bg-color-light: #f5f5f5;
    --text-color-light: #111;
  }

  body {
    font-family: 'Inter', sans-serif;
    margin: 20px;
    background-color: var(--bg-color-dark);
    color: var(--text-color-dark);
    transition: background-color 0.5s, color 0.5s;
  }

  #chat {
    max-width: 600px;
    margin: auto;
    border-radius: 8px;
    background-color: rgba(0, 0, 0, 0.85);
    padding: 15px;
    position: relative;
    box-sizing: border-box;
  }

  /* RGB ambient thin line behind chat */
  #chat::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;  /* thin line */
    border-radius: 8px 8px 0 0;
    background: linear-gradient(270deg, #ff0000, #00ff00, #0000ff);
    background-size: 600% 600%;
    animation: rgbLine 60s ease infinite;
    pointer-events: none;
    z-index: 1;
  }

  @keyframes rgbLine {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .message {
    margin-bottom: 15px;
    white-space: pre-wrap;
    font-family: monospace;
    position: relative;
    z-index: 2;
  }
  .bot { color: #6cf; }
  .user { color: #fc6; text-align: right; }

  button.option-btn {
    background-color: #333;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 6px 12px;
    margin: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  button.option-btn:hover {
    background-color: #555;
  }

  #menu {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 10000;
  }
  .menu-btn {
    padding: 8px 12px;
    background: #222;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    margin-left: 6px;
    transition: background-color 0.3s;
  }
  .menu-btn:hover {
    background-color: #444;
  }

  .rainbow-link {
    animation: rainbow 2s infinite;
    font-weight: bold;
    color: #fff;
    text-decoration: underline;
  }
  @keyframes rainbow {
    0% {color: red;}
    25% {color: yellow;}
    50% {color: lime;}
    75% {color: cyan;}
    100% {color: magenta;}
  }
</style>
</head>
<body>

<div id="menu">
  <button class="menu-btn" onclick="location.href='https://mehmetakifkaraman.github.io/'">Main Menu</button>
  <button class="menu-btn" onclick="toggleTheme()">Toggle Theme</button>
</div>

<div id="chat"></div>

<script>
  const chat = document.getElementById('chat');
  const state = { step: 0, project: null, theme: 'dark' };

  const projectNames = {
    "1": "1Ô∏è‚É£ Blink an LED",
    "2": "2Ô∏è‚É£ Button LED Control",
    "3": "3Ô∏è‚É£ DHT11 Temp Sensor",
    "4": "4Ô∏è‚É£ Servo Motor",
    "5": "5Ô∏è‚É£ LCD Display"
  };

  function toggleTheme() {
    const root = document.documentElement;
    if (state.theme === 'dark') {
      state.theme = 'light';
      root.style.setProperty('--bg-color-dark', 'var(--bg-color-light)');
      root.style.setProperty('--text-color-dark', 'var(--text-color-light)');
      document.body.style.backgroundColor = getComputedStyle(root).getPropertyValue('--bg-color-light').trim();
      document.body.style.color = getComputedStyle(root).getPropertyValue('--text-color-light').trim();
      document.getElementById('chat').style.backgroundColor = 'rgba(245, 245, 245, 0.85)';
    } else {
      state.theme = 'dark';
      root.style.setProperty('--bg-color-dark', '#000000');
      root.style.setProperty('--text-color-dark', '#eee');
      document.body.style.backgroundColor = '#000000';
      document.body.style.color = '#eee';
      document.getElementById('chat').style.backgroundColor = 'rgba(0, 0, 0, 0.85)';
    }
  }

  async function slowPrint(text, speed = 30, className = 'bot') {
    const messageElem = document.createElement('div');
    messageElem.className = 'message ' + className;
    chat.appendChild(messageElem);
    for (let i = 0; i < text.length; i++) {
      messageElem.textContent += text[i];
      await new Promise(r => setTimeout(r, speed));
      window.scrollTo(0, document.body.scrollHeight);
    }
    return messageElem;
  }

  function showUserMessage(text) {
    const userMsg = document.createElement('div');
    userMsg.className = 'message user';
    userMsg.textContent = text;
    chat.appendChild(userMsg);
    window.scrollTo(0, document.body.scrollHeight);
  }

  function createOptions(options) {
    const container = document.createElement('div');
    container.style.marginBottom = '15px';
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt.label;
      btn.className = 'option-btn';
      btn.onclick = () => {
        container.remove();
        handleUserInput(opt.value);
      };
      container.appendChild(btn);
    });
    chat.appendChild(container);
    window.scrollTo(0, document.body.scrollHeight);
  }

  async function handleUserInput(input) {
    // For step 1 (project choice), show full label not just number
    if (state.step === 1 && projectNames[input]) {
      showUserMessage(projectNames[input]);
    } else {
      showUserMessage(input);
    }

    switch (state.step) {
      case 0:
        if (input === 'installed') {
          await slowPrint("Great! Let's continue. üéâ");
          state.step++;
          askProjectChoice();
        } else if (input === 'not_installed') {
          await slowPrint("No worries! You can download the Arduino IDE here:");
          const link = document.createElement('a');
          link.href = "https://www.arduino.cc/en/software";
          link.textContent = "https://www.arduino.cc/en/software";
          link.className = "rainbow-link";
          link.target = "_blank";
          chat.appendChild(link);

          const button = document.createElement('button');
          button.textContent = "I have installed it";
          button.className = "option-btn";
          button.onclick = async () => {
            button.remove();
            link.remove();
            showUserMessage("I have installed it");
            await slowPrint("Great! Let's continue. üéâ");
            state.step++;
            askProjectChoice();
          };
          chat.appendChild(button);
          window.scrollTo(0, document.body.scrollHeight);
        }
        break;

      case 1:
        if (['1','2','3','4','5'].includes(input)) {
          state.project = input;
          await showProjectDetails(input);
        } else {
          await slowPrint("Please select a valid option.");
          askProjectChoice();
        }
        break;

      case 2:
        await slowPrint("üí° Would you like to try another project?");
        createOptions([
          {label: "Yes", value: "restart"},
          {label: "No", value: "end"}
        ]);
        state.step = 3;
        break;

      case 3:
        if (input === "restart") {
          state.step = 1;
          askProjectChoice();
        } else {
          await slowPrint("Thanks for using ARAI! ü§ñ");
          await slowPrint("Do you want help with anything else?");
        }
        break;
    }
  }

  function askIdeStatus() {
    slowPrint("Hello! I'm ARAI ü§ñ Your Arduino project assistant.\n")
    .then(() => {
      slowPrint("Is Arduino IDE installed on your computer?").then(() => {
        createOptions([
          {label: "Installed", value: "installed"},
          {label: "Not Installed", value: "not_installed"}
        ]);
      });
    });
  }

  function askProjectChoice() {
    slowPrint("What would you like to do? Choose a number:\n1Ô∏è‚É£ Blink an LED\n2Ô∏è‚É£ Control LED with a button\n3Ô∏è‚É£ Measure temperature with DHT11\n4Ô∏è‚É£ Servo motor control\n5Ô∏è‚É£ Display on LCD")
    .then(() => {
      createOptions([
        {label: "1Ô∏è‚É£ Blink an LED", value: "1"},
        {label: "2Ô∏è‚É£ Button LED Control", value: "2"},
        {label: "3Ô∏è‚É£ DHT11 Temp Sensor", value: "3"},
        {label: "4Ô∏è‚É£ Servo Motor", value: "4"},
        {label: "5Ô∏è‚É£ LCD Display", value: "5"},
      ]);
    });
  }

  async function showProjectDetails(choice) {
    const details = {
      "1": {
        materials: "Materials needed:\nüîπ Arduino Uno\nüîπ LED\nüîπ 220Œ© resistor\nüîπ Jumper wires",
        steps: "Steps:\n1Ô∏è‚É£ Connect long leg of LED to pin 13\n2Ô∏è‚É£ Short leg to GND through resistor",
        code: [
          "// Your Arduino code:",
          "int ledPin = 13;",
          "void setup() { pinMode(ledPin, OUTPUT); }",
          "void loop() {",
          "  digitalWrite(ledPin, HIGH); delay(1000);",
          "  digitalWrite(ledPin, LOW); delay(1000);",
          "}"
        ]
      },
      "2": {
        materials: "Materials needed:\nüîπ Arduino\nüîπ Button\nüîπ LED\nüîπ 220Œ© Resistor\nüîπ Wires",
        steps: "Steps:\n1Ô∏è‚É£ Button to pin 2 and GND\n2Ô∏è‚É£ LED to pin 13 through resistor",
        code: [
          "// Your Arduino code:",
          "int ledPin = 13, buttonPin = 2, buttonState = 0;",
          "void setup() {",
          "  pinMode(ledPin, OUTPUT); pinMode(buttonPin, INPUT);",
          "}",
          "void loop() {",
          "  buttonState = digitalRead(buttonPin);",
          "  digitalWrite(ledPin, buttonState);",
          "}"
        ]
      },
      "3": {
        materials: "Materials needed:\nüîπ Arduino\nüîπ DHT11 Sensor\nüîπ Jumper wires",
        steps: "Steps:\n1Ô∏è‚É£ VCC to 5V\n2Ô∏è‚É£ GND to GND\n3Ô∏è‚É£ Data to pin 2",
        code: [
          "// Your Arduino code:",
          "#include <DHT.h>",
          "#define DHTPIN 2",
          "#define DHTTYPE DHT11",
          "DHT dht(DHTPIN, DHTTYPE);",
          "void setup() { Serial.begin(9600); dht.begin(); }",
          "void loop() {",
          "  float t = dht.readTemperature();",
          "  float h = dht.readHumidity();",
          "  Serial.print(\"Temp: \"); Serial.println(t);",
          "  Serial.print(\"Humidity: \"); Serial.println(h);",
          "  delay(2000);",
          "}"
        ]
      },
      "4": {
        materials: "Materials needed:\nüîπ Arduino\nüîπ Servo Motor\nüîπ Jumper wires",
        steps: "Steps:\n1Ô∏è‚É£ Servo signal to pin 9\n2Ô∏è‚É£ VCC to 5V\n3Ô∏è‚É£ GND to GND",
        code: [
          "// Your Arduino code:",
          "#include <Servo.h>",
          "Servo myServo;",
          "void setup() { myServo.attach(9); }",
          "void loop() {",
          "  myServo.write(0); delay(1000);",
          "  myServo.write(90); delay(1000);",
          "  myServo.write(180); delay(1000);",
          "}"
        ]
      },
      "5": {
        materials: "Materials needed:\nüîπ Arduino\nüîπ 16x2 LCD (I2C)\nüîπ Wires",
        steps: "Steps:\n1Ô∏è‚É£ Connect I2C: SDA to A4, SCL to A5, VCC, GND",
        code: [
          "// Your Arduino code:",
          "#include <Wire.h>",
          "#include <LiquidCrystal_I2C.h>",
          "LiquidCrystal_I2C lcd(0x27, 16, 2);",
          "void setup() {",
          "  lcd.begin(); lcd.backlight();",
          "  lcd.setCursor(0,0); lcd.print(\"Hello, world!\");",
          "}",
          "void loop() {}"
        ]
      }
    };

    const p = details[choice];
    if (!p) return;

    await slowPrint(p.materials);
    await slowPrint(p.steps);
    for (const line of p.code) {
      await slowPrint(line, 50);
    }

    state.step = 2;
  }

  // Start interaction
  askIdeStatus();
</script>

</body>
</html>
